[TOC]

# 異動歷程

| 異動日期       | 動作 | 單號                                                                    | 異動內容 | 異動人 |
|------------| ---- | ----------------------------------------------------------------------- | -------- |:----|
| 2025/05/03 | 新增 |  | 新增 API | 綠界後端通知付款結果（正式依據）    |

# API 規格

| 項目   | 說明                                                  |
| :----- |:----------------------------------------------------|
| Method | POST                                                |
| 測試環境    | [Domain]/api/payment/ecpay/return                 |
| 正式環境    | [Domain]/api/payment/ecpay/return  |

## API 請求參數（header）

| 欄位名稱     | 格式   | 說明             |
| :----------- | :----- | :--------------- |
| Content-Type | String | application/x-www-form-urlencoded |

## Request
| 參數名稱                   | 說明               | 範例                  |
| ---------------------- | ---------------- | ------------------- |
| `MerchantID`           | 商店代號             | 2000132             |
| `MerchantTradeNo`      | 商店訂單編號（需唯一）      | TEST20240801001     |
| `TradeNo`              | 綠界交易編號（可用來查詢訂單）  | 23083112345678901   |
| `TradeAmt`             | 交易金額（單位：元）       | 1000                |
| `PaymentDate`          | 付款完成時間           | 2024/08/01 16:35:42 |
| `PaymentType`          | 付款方式             | Credit\_CreditCard  |
| `PaymentTypeChargeFee` | 金流手續費（如有）        | 30                  |
| `RtnCode`              | 回傳狀態碼（`1` 表成功）   | 1                   |
| `RtnMsg`               | 回傳訊息（如 `交易成功`）   | 交易成功                |
| `SimulatePaid`         | 是否為模擬付款（僅測試環境會有） | 0                   |
| `CheckMacValue`        | 驗證碼（防止參數被竄改）     | ABCDEF123456...     |

```json

```

## Response

**成功**

| 階層 | 欄位名稱 | 中文名稱 | 欄位    | M/O | 說明          |
|:--:|------| -------- | ------- | --- | ------------- |
| 1  |      | 執行結果 |  | M   | "1|OK" "0|FAIL" |


```json

```

# 邏輯

## 步驟一、進行 CheckMacValue 驗證（防止偽造）

## 步驟二、處理付款狀態，例如更新訂單為已付款
 發送通知、入庫記錄

## 步驟四、組裝 Response 回傳

- 組裝成功 Response 回傳

  | 階層 | 欄位名稱 | 中文名稱 | 說明       |
        | :--: | :------- | :------- |:---------|
  |  1   | success  | 執行結果 | "1\|\OK" |


